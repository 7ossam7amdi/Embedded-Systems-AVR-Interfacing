/********************************************************/
/*	Name	: SPI_program.c								*/
/*  Layer	: MCAL										*/
/*	Author	: Hossam Hamdy								*/
/* 	Date	: 4 October	2023							*/
/*	Version	: V01										*/
/********************************************************/

#include "LIB/Std_Types.h"
#include "LIB/Bit_Math.h"
#include "SPI_config.h"
#include "SPI_interface.h"
#include "SPI_private.h"
#include "SPI_register.h"

void SPI_Init_Master (){

		/*   MASTER     */
		/* Set MOSI Pin */
		DIO_Void_SetPinDirection(PortB,Pin5,output);
		/* Set MISO Pin */
		DIO_Void_SetPinDirection(PortB,Pin6,input);
		/*Set CLK Pin*/
		DIO_Void_SetPinDirection(PortB,Pin7,output);
		/*Set CS Pin*/
		DIO_Void_SetPinDirection(PortB,Pin4,output);


		/*Enable SPI Master and set clk= f/16 */

		SET_BIT(SPCR,Pin4); //master

		SET_BIT(SPCR,Pin0); //clk
		CLR_BIT(SPCR,Pin1);
		CLR_BIT(SPSR,Pin0);

		/* LSB Enable*/

		SET_BIT(SPCR,Pin5);

		/* Phase , Pol 0*/

		CLR_BIT(SPCR,Pin3);

		CLR_BIT(SPCR,Pin2);

		/*Enable SPI*/

		SET_BIT(SPCR,Pin6);
}

	//========================================
void SPI_Init_Slave (){
	/*    SLAVE     */
	/* Set MOSI Pin */
	DIO_Void_SetPinDirection(PortB,Pin5,input);
	/* Set MISO Pin */
	DIO_Void_SetPinDirection(PortB,Pin6,output);
	/*Set CLK Pin*/
	DIO_Void_SetPinDirection(PortB,Pin7,input);
	/*Set CS Pin*/
	DIO_Void_SetPinDirection(PortB,Pin4,input);

	/*Enable SPI Slave */

	CLR_BIT(SPCR,Pin4); //slave

	/* LSB Enable*/

	SET_BIT(SPCR,Pin5);

	/* Phase , Pol 0*/

	CLR_BIT(SPCR,Pin3);

	CLR_BIT(SPCR,Pin2);

	/*Enable SPI*/

	SET_BIT(SPCR,Pin6);


}

//=================================

void SPI_Transmit (uint8 data) {

	SPDR = data;
	while(!(GET_BIT(SPSR,Pin7))){

	}
}

uint8 SPI_Receive (void){

	/*while(!(GET_BIT(SPSR,Pin7))){

		}*/

	return SPDR;
}
