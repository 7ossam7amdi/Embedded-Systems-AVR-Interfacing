/********************************************************/
/*	Name	: UART_program.c							*/
/*  Layer	: MCAL										*/
/*	Author	: Hossam Hamdy								*/
/* 	Date	: 27 September 2023							*/
/*	Version	: V01										*/
/********************************************************/


#include "LIB/Std_Types.h"
#include "LIB/Bit_Math.h"
#include "DIO/DIO_interface.h"
#include "UART_config.h"
#include "UART_interface.h"
#include "UART_private.h"
#include "UART_register.h"





void UART_Init (uint16 Baudrate){

	uint8 TempUC = 0;
	uint8 TempUH = 0;

	/* Enable UBRRH by URSEL */
	CLR_BIT(TempUH,UCSRC_URSEL);

	/* Set Baudrate */
	uint16 ubrr = (16000000UL/(16UL*Baudrate)) - 1 ;

	UBRRL = (uint8) ubrr;
	TempUH = (uint8) (ubrr >> 8);

	UBRRH = TempUH;

	/* Enable UCSRC by URSEL */
	SET_BIT(TempUC,UCSRC_URSEL);

	/* Choose Sync modes */
	#if SYNC == ASYNCHRONOUS
		CLR_BIT(TempUC,UCSRC_UMSEL);

	#elif SYNC == SYNCHRONOUS
		SET_BIT(TempUC,UCSRC_UMSEL);
	#endif


		/* Parity Selection  */

	#if PARITY == DISABLED
		CLR_BIT(TempUC,UCSRC_UPM0);
		CLR_BIT(TempUC,UCSRC_UPM1);

	#elif PARITY == EVEN
		CLR_BIT(TempUC,UCSRC_UPM0);
		SET_BIT(TempUC,UCSRC_UPM1);

	#elif PARITY == ODD
		SET_BIT(TempUC,UCSRC_UPM0);
		SET_BIT(TempUC,UCSRC_UPM1);
	#endif



	/* Stop bit Selection */

	#if STOP_BITS == STOP1
		CLR_BIT(TempUC,UCSRC_USBS);

	#elif STOP_BITS == STOP2
		SET_BIT(TempUC,UCSRC_USBS);

	#endif


	/* Choose Char Size */

	#ifdef	CHAR_SIZE == BIT5
		CLR_BIT(TempUC,UCSRC_UCSZ0);
		CLR_BIT(TempUC,UCSRC_UCSZ1);
	#elif


	#endif







	//CLR_BIT(UCSRB,Pin2);


	UCSRC = TempUC;

	//double speed
	SET_BIT(UCSRA,Pin1);

	/* enable transmitter */
	SET_BIT(UCSRB,Pin3);

	/* enable receiver */
	SET_BIT(UCSRB,Pin4);



}
